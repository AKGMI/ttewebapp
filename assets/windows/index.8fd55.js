System.register("chunks:///_virtual/BaseWindow.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIManager.ts"],(function(e){var n,t,i,o,r,s,a,c,l,u,d,h,p,g,f,b,v;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,i=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){r=e.cclegacy,s=e._decorator,a=e.Node,c=e.BlockInputEvents,l=e.UIOpacity,u=e.tween,d=e.Vec3,h=e.resources,p=e.assetManager,g=e.Component,f=e.Prefab,b=e.SpriteFrame},function(e){v=e.UIManager}],execute:function(){var k,m,C,y,w,P,A,E,L,S;r._RF.push({},"16d0a5olKpLr7LGehTEWhcp","BaseWindow",void 0);var B=s.ccclass,D=s.property;e("BaseWindow",(k=B("BaseWindow"),m=D(a),C=D(a),k((P=n((w=function(e){function n(){for(var n,t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return n=e.call.apply(e,[this].concat(r))||this,i(n,"background",P,o(n)),i(n,"content",A,o(n)),i(n,"closeOnShadowClick",E,o(n)),i(n,"useAnimation",L,o(n)),i(n,"animationDuration",S,o(n)),n.isProcessingClick=!1,n.eventListenersAdded=!1,n.originalScale=null,n.closeCallback=null,n.resourcesForPreload=[],n.bundlesForPreload=[],n.resourcesPreloaded=!1,n}t(n,e);var r=n.prototype;return r.onLoad=function(){this.content||(this.content=this.node),this.originalScale=this.content.getScale().clone()},r.init=function(e){},r.close=function(){this.removeEventListeners(),this.useAnimation?this.playCloseAnimation():this.node.active=!1},r.open=function(e){if(console.log("Opening window"),this.node.active=!0,this.background&&(this.background.getComponent(c)||this.background.addComponent(c),this.addEventListeners(),this.useAnimation)){var n=this.background.getComponent(l)||this.background.addComponent(l);n.opacity=0,u(n).to(this.animationDuration,{opacity:255}).start()}this.useAnimation&&this.playOpenAnimation(),this.init(e)},r.playOpenAnimation=function(){this.content&&(u(this.content).stop(),this.content.setScale(new d(.5,.5,1)),u(this.content).to(this.animationDuration,{scale:new d(1.05*this.originalScale.x,1.05*this.originalScale.y,this.originalScale.z)},{easing:"backOut"}).to(.1,{scale:this.originalScale}).start())},r.playCloseAnimation=function(){var e=this;this.content?(u(this.content).stop(),this.background,u(this.content).to(this.animationDuration,{scale:new d(.5,.5,1)},{easing:"backIn"}).call((function(){e.node.active=!1})).start()):this.node.active=!1},r.addEventListeners=function(){this.background&&this.closeOnShadowClick&&!this.eventListenersAdded&&(this.background.off(a.EventType.TOUCH_END,this.onBackgroundClick,this),this.background.on(a.EventType.TOUCH_END,this.onBackgroundClick,this),this.eventListenersAdded=!0)},r.removeEventListeners=function(){this.background&&this.eventListenersAdded&&(this.background.off(a.EventType.TOUCH_END,this.onBackgroundClick,this),this.eventListenersAdded=!1)},r.onBackgroundClick=function(){var e=this;this.isProcessingClick||(this.isProcessingClick=!0,v.getInstance().windowsManager.hideActiveWindow(),setTimeout((function(){e.isProcessingClick=!1}),300))},r.onDisable=function(){this.removeEventListeners()},r.setCloseCallback=function(e){this.closeCallback=e},r.preloadResources=function(e){var n=this;if(this.resourcesPreloaded)e&&e();else{var t=0,i=0,o=this.resourcesForPreload.length,r=this.bundlesForPreload.length,s=function(){t===o&&i===r&&(n.resourcesPreloaded=!0,e&&e())};if(0===o&&0===r)return this.resourcesPreloaded=!0,void(e&&e());o>0&&this.resourcesForPreload.forEach((function(e){var n=null;e.endsWith(".prefab")?n=f:e.includes("/spriteFrame")&&(n=b),h.load(e,n,(function(n,i){n?console.error("Failed to preload resource: "+e,n):console.log("Resource preloaded: "+e),t++,s()}))})),r>0&&this.bundlesForPreload.forEach((function(e){p.loadBundle(e,(function(n,t){n?console.error("Failed to preload bundle: "+e,n):console.log("Bundle preloaded: "+e),i++,s()}))}))}},r.areResourcesPreloaded=function(){return this.resourcesPreloaded},n}(g)).prototype,"background",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=n(w.prototype,"content",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=n(w.prototype,"closeOnShadowClick",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),L=n(w.prototype,"useAnimation",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),S=n(w.prototype,"animationDuration",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),y=w))||y));r._RF.pop()}}}));

System.register("chunks:///_virtual/LootboxWindow.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseWindow.ts","./ApiClient.ts","./UIManager.ts","./TelegramSDK.ts","./PlayerDataManager.ts","./LoadingService.ts","./VibrationService2.ts"],(function(t){var e,n,o,i,r,a,s,l,c,u,p,d,h,g,w,f,b,v,y,x,m,C,T,B,I,N;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,o=t.initializerDefineProperty,i=t.assertThisInitialized,r=t.asyncToGenerator,a=t.regeneratorRuntime},function(t){s=t.cclegacy,l=t._decorator,c=t.Node,u=t.ProgressBar,p=t.Label,d=t.Prefab,h=t.RichText,g=t.tween,w=t.Animation,f=t.Sprite,b=t.Canvas,v=t.instantiate,y=t.Vec3},function(t){x=t.BaseWindow},function(t){m=t.ApiClient},function(t){C=t.UIManager},function(t){T=t.TelegramSDK},function(t){B=t.PlayerDataManager},function(t){I=t.LoadingService},function(t){N=t.VibrationService}],execute:function(){var P,k,S,E,W,O,_,R,U,D,F,A,L,M,H,z,G,V,q;s._RF.push({},"9413bPYeoZC4biL3iElH1Rx","LootboxWindow",void 0);var K=l.ccclass,j=l.property;t("LootboxWindow",(P=K("LootboxWindow"),k=j(c),S=j(c),E=j(u),W=j(p),O=j(c),_=j(c),R=j(c),U=j(d),P((A=e((F=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,o(e,"lootboxOpacity",A,i(e)),o(e,"lootboxProgress",L,i(e)),o(e,"lineProgress",M,i(e)),o(e,"progressText",H,i(e)),o(e,"openNowSection",z,i(e)),o(e,"openButton",G,i(e)),o(e,"continueButton",V,i(e)),o(e,"expPrefab",q,i(e)),e.lootboxId=null,e.currentTween=null,e.progress=null,e.target=null,e.expGained=null,e.callback=null,e.isRewardWindowPreloaded=!1,e}n(e,t);var s=e.prototype;return s.open=function(e){if(t.prototype.open.call(this,e),e){var n=e.lootboxId,o=e.progress,i=e.target,r=e.expGained,a=e.callback;this.lootboxId=n,this.progress=o,this.target=i,this.expGained=r,this.callback=a;var s=o/i,l=r/i;B.getInstance().addLootboxProgress(l),this.continueButton.on(c.EventType.TOUCH_END,this.onContinueButtonClicked,this),this.openButton.on(c.EventType.TOUCH_END,this.onOpenButtonClicked,this),this.openNowSection.getChildByName("Button").on(c.EventType.TOUCH_END,this.onOpenNowButtonClicked,this);var u=+((this.progress+this.expGained)/this.target).toFixed(1),p="";p=u<=.3?"5":u<=.6?"8":"10",this.openNowSection.getChildByName("Button").getChildByName("Label").getChildByName("Text").getComponent(h).string=p,s>=1?(this.displayFilledState(),this.preloadRewardWindow()):r?this.startFillingAnimation(o,i,r):this.displayNotFilledState(o,i)}else console.error("Lootbox data is not provided!")},s.close=function(){t.prototype.close.call(this),this.continueButton.off(c.EventType.TOUCH_END),this.openButton.off(c.EventType.TOUCH_END),this.openNowSection.getChildByName("Button").off(c.EventType.TOUCH_END),this.currentTween&&(this.currentTween.stop(),this.currentTween=null)},s.preloadRewardWindow=function(){this.isRewardWindowPreloaded||(this.isRewardWindowPreloaded=!0,C.getInstance().windowsManager.preloadWindow("RewardWindow",(function(){console.log("RewardWindow preloaded successfully")})))},s.skipAnimation=function(t){this.node.off(c.EventType.TOUCH_END,this.skipAnimation,this),this.currentTween&&(this.currentTween.stop(),this.currentTween=null,this.updateProgressUI(this.progress/this.target),this.progress/this.target+this.expGained/this.target>=1?(this.displayFilledState(),this.preloadRewardWindow()):this.displayNotFilledState(this.progress+this.expGained,this.target))},s.startFillingAnimation=function(t,e,n){var o=this;this.node.on(c.EventType.TOUCH_END,this.skipAnimation,this),this.openNowSection.active=!1,this.openButton.active=!1,this.continueButton.active=!1;var i=t/e,r=n/e;this.currentTween=g({value:i}).call((function(){o.spawnAndAnimateExp(n,o.lootboxProgress.worldPosition)})).to(2,{value:Math.min(1,i+r)},{easing:"quadInOut",onUpdate:function(t){o.updateProgressUI(t.value)}}).call((function(){i+r>=1?(o.displayFilledState(),o.preloadRewardWindow()):o.displayNotFilledState(t+n,e),o.currentTween=null})).start()},s.displayNotFilledState=function(t,e){this.openButton.active=!1,this.continueButton.active=!0,this.expGained&&(this.openNowSection.active=!0);var n=t/e;this.updateProgressUI(n)},s.displayFilledState=function(){var t;this.openNowSection.active=!1,this.openButton.active=!0,this.continueButton.active=!1,this.lootboxOpacity.active=!1,this.lineProgress.node.active=!1,this.progressText.node.active=!1,null==(t=this.lootboxProgress)||null==(t=t.getComponent(w))||t.play(),this.updateProgressUI(1)},s.updateProgressUI=function(t){var e=Math.floor(100*t);this.progressText.string=e+"%",this.lootboxProgress.getChildByName("animation_controller").getChildByName("sprite_box").getChildByName("main").getComponent(f).fillRange=t,this.lineProgress.progress=t},s.spawnAndAnimateExp=function(t,e){var n=this,o=this.node.scene.getComponentInChildren(b);if(o)for(var i=function(){var t=v(n.expPrefab);o.node.addChild(t);var i=350*(Math.random()-.5)*2,r=350*(Math.random()-.5)*2;t.setPosition(new y(i,r,0)),t.setScale(new y(0,0,0));var a=o.node.inverseTransformPoint(new y,e);g(t).to(.3,{scale:new y(.6,.6,.6)},{easing:"quadOut"}).start();var s=.5*Math.random();g(t).delay(s).to(1.2,{position:a},{easing:"quadInOut"}).call((function(){t.destroy()})).start()},r=0;r<t;r++)i();else console.error("Canvas не найден в сцене!")},s.onOpenNowButtonClicked=function(){var t=r(a().mark((function t(){var e,n=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return I.getInstance().show(),t.next=3,m.getInstance().post("/api/payments/create-invoice",{productId:"open_now",metadata:{lootboxId:this.lootboxId,progress:((this.progress+this.expGained)/this.target).toFixed(1)}});case 3:e=t.sent,T.getInstance().openInvoice(e.invoiceUrl,(function(t){"paid"===t?n.onOpenButtonClicked():m.getInstance().post("/api/payments/cancel",{orderId:e.orderId}),I.getInstance().hide()}));case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),s.onContinueButtonClicked=function(){this.callback&&this.callback(),this.close()},s.onOpenButtonClicked=function(){var t=r(a().mark((function t(){var e,n,o,i=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return N.getInstance().mediumVibration(),this.openButton.getChildByName("TextWrapper").active=!1,t.next=4,I.getInstance().withLoading(m.getInstance().post("/api/lootbox/open",{lootboxId:this.lootboxId}));case 4:if(t.t0=e=t.sent,null!=t.t0){t.next=9;break}t.t1=void 0,t.next=10;break;case 9:t.t1=e.rewards;case 10:(n=t.t1)?this.lootboxProgress&&((o=this.lootboxProgress.getComponent(w))?(this.lootboxOpacity.active=!1,o.play("greenbox_open-001"),o.on(w.EventType.FINISHED,(function(){C.getInstance().windowsManager.showWindow("RewardWindow",{rewardId:n._id,rewards:n.items,claimCallback:i.callback})}))):(console.warn("Animation component not found on animationTarget"),C.getInstance().windowsManager.showWindow("RewardWindow",{rewardId:n._id,rewards:n.items,claimCallback:this.callback}))):(this.callback&&this.callback(),this.close());case 12:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),e}(x)).prototype,"lootboxOpacity",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=e(F.prototype,"lootboxProgress",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(F.prototype,"lineProgress",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=e(F.prototype,"progressText",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(F.prototype,"openNowSection",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=e(F.prototype,"openButton",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=e(F.prototype,"continueButton",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=e(F.prototype,"expPrefab",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=F))||D));s._RF.pop()}}}));

System.register("chunks:///_virtual/RewardConfigManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./reward_config.json"],(function(e){var n,t,r,i,o,a;return{setters:[function(e){n=e.inheritsLoose,t=e.extends},function(e){r=e.cclegacy,i=e._decorator,o=e.Component},function(e){a=e.default}],execute:function(){var s,c;r._RF.push({},"d8d14H9y5hF3J68cNhhBbuY","RewardConfigManager",void 0);var u=i.ccclass;e("RewardConfigManager",u("RewardConfigManager")(((c=function(e){function r(){var n;return(n=e.call(this)||this).rewardConfigs=new Map,n.loadConfigs(),n}n(r,e),r.getInstance=function(){return this._instance||(this._instance=new r),this._instance};var i=r.prototype;return i.loadConfigs=function(){var e=this,n=a;n.forEach((function(n){e.rewardConfigs.set(n.type,n)})),n.forEach((function(n){if(n.extends){var t=e.resolveInheritance(n);t&&e.rewardConfigs.set(n.type,t)}}))},i.resolveInheritance=function(e,n){if(void 0===n&&(n=new Set),!e.extends)return e;if(n.has(e.type))return console.error('Циклическое наследование обнаружено для конфигурации "'+e.type+'"'),null;n.add(e.type);var r=this.rewardConfigs.get(e.extends);if(!r)return console.error('Родительская конфигурация "'+e.extends+'" для "'+e.type+'" не найдена'),null;var i=this.resolveInheritance(r,n);if(!i)return null;var o=t({},i,e,{outline:t({},i.outline,e.outline)});return delete o.extends,o},i.getConfig=function(e){return this.rewardConfigs.get(e)||null},r}(o))._instance=void 0,s=c))||s);r._RF.pop()}}}));

System.register("chunks:///_virtual/RewardItem.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RewardConfigManager.ts","./TextWithIcon.ts"],(function(t){var n,o,r,e,i,a,c,u,s,l,d,g,h,f,p,m;return{setters:[function(t){n=t.applyDecoratedDescriptor,o=t.inheritsLoose,r=t.initializerDefineProperty,e=t.assertThisInitialized,i=t.construct},function(t){a=t.cclegacy,c=t._decorator,u=t.Sprite,s=t.Node,l=t.Color,d=t.resources,g=t.SpriteFrame,h=t.UITransform,f=t.Component},function(t){p=t.RewardConfigManager},function(t){m=t.TextWithIcon}],execute:function(){var w,b,k,C,y,I,B,v,x,R,z,W,F,S,P,T,A;a._RF.push({},"3dde8RmhatD7pZZlmY6vY0Y","RewardItem",void 0);var D=c.ccclass,_=c.property;t("RewardItem",(w=D("RewardItem"),b=_(u),k=_(u),C=_(u),y=_(u),I=_(m),B=_(s),v=_([s]),w((z=n((R=function(t){function n(){for(var n,o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];return n=t.call.apply(t,[this].concat(i))||this,r(n,"background",z,e(n)),r(n,"icon",W,e(n)),r(n,"rewardBackground",F,e(n)),r(n,"amountBackground",S,e(n)),r(n,"textWithIcon",P,e(n)),r(n,"starsContainer",T,e(n)),r(n,"stars",A,e(n)),n.config=null,n.type=null,n.amount=null,n}o(n,t);var a=n.prototype;return a.getType=function(){return this.type},a.getAmount=function(){return this.amount},a.setAmount=function(t){if(this.amount=t,this.textWithIcon){var n=this.config.textTemplate||"+{amount}";this.textWithIcon.setTextWithIcon(n.replace("{amount}",""+t)),this.config.textColor&&this.textWithIcon.setTextStyle(i(l,this.config.textColor),this.config.fontSize),this.config.direction&&this.textWithIcon.setDirectionAndSpacing(this.config.direction,this.config.spacing),this.config.outline&&this.config.outline.color&&this.config.outline.width&&this.textWithIcon.setOutline(i(l,this.config.outline.color),this.config.outline.width)}},a.setStarsCount=function(t){if(this.starsContainer&&this.stars&&0!==this.stars.length){this.starsContainer.active=t>0;for(var n=0;n<this.stars.length;n++)this.stars[n]&&(this.stars[n].active=n<t)}},a.applyReward=function(t,n){var o=this,r=this.config=p.getInstance().getConfig(t);if(this.type=t,this.amount=n,r){if(r.backgroundImagePath&&d.load(r.backgroundImagePath,g,(function(n,r){n?console.error("Failed to load icon for "+t+":",n):o.background.spriteFrame=r})),r.backgroundColor){var e=r.backgroundColor,i=e[0],a=e[1],c=e[2],u=e[3];this.background&&(this.background.color=new l(i,a,c,u))}if(this.icon&&r.iconPath&&d.load(r.iconPath,g,(function(n,r){n?console.error("Failed to load icon for "+t+":",n):o.icon.spriteFrame=r})),this.rewardBackground&&(r.rewardBackgroundImagePath&&d.load(r.rewardBackgroundImagePath,g,(function(n,r){n?console.error("Failed to load icon for "+t+":",n):(o.rewardBackground.color=new l(255,255,255,255),o.rewardBackground.spriteFrame=r,o.rewardBackground.node.getComponent(h).width=285,o.rewardBackground.node.getComponent(h).height=359)})),r.rewardBackgroundColor)){var s=r.rewardBackgroundColor,f=s[0],m=s[1],w=s[2],b=s[3];this.rewardBackground.color=new l(f,m,w,b)}if(this.amountBackground&&r.amountBackgroundColor){var k=r.amountBackgroundColor,C=k[0],y=k[1],I=k[2],B=k[3];this.amountBackground.color=new l(C,y,I,B)}this.setAmount(n),void 0!==r.starsCount?this.setStarsCount(r.starsCount):this.setStarsCount(0)}else console.warn('Reward type "'+t+'" not found in config.')},n}(f)).prototype,"background",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=n(R.prototype,"icon",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=n(R.prototype,"rewardBackground",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=n(R.prototype,"amountBackground",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=n(R.prototype,"textWithIcon",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=n(R.prototype,"starsContainer",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=n(R.prototype,"stars",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),x=R))||x));a._RF.pop()}}}));

System.register("chunks:///_virtual/RewardWindow.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseWindow.ts","./RewardItem.ts","./ApiClient.ts","./PlayerDataManager.ts","./AdsGramSDK.ts","./TelegramSDK.ts","./LoadingService.ts","./RewardLayoutScaler.ts","./VibrationService2.ts"],(function(t){var e,n,a,i,r,o,s,c,l,u,d,p,m,h,w,f,b,g,C,y,v,I,B,T,k;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,a=t.initializerDefineProperty,i=t.assertThisInitialized,r=t.asyncToGenerator,o=t.regeneratorRuntime},function(t){s=t.cclegacy,c=t._decorator,l=t.Node,u=t.Prefab,d=t.Button,p=t.UIOpacity,m=t.instantiate,h=t.Layout,w=t.tween,f=t.Vec3},function(t){b=t.BaseWindow},function(t){g=t.RewardItem},function(t){C=t.ApiClient},function(t){y=t.PlayerDataManager},function(t){v=t.AdsGramSDK},function(t){I=t.TelegramSDK},function(t){B=t.LoadingService},function(t){T=t.RewardLayoutScaler},function(t){k=t.VibrationService}],execute:function(){var _,D,P,X,R,x,F,E,O,S,z,A,L,U,W,N,H,G,K,V,q;s._RF.push({},"de6c6AZTXpJxq5CuT30O/ZC","RewardWindow",void 0);var M=c.ccclass,j=c.property;t("RewardWindow",(_=M("RewardWindow"),D=j(l),P=j(l),X=j(u),R=j(d),x=j(d),F=j(d),E=j(l),O=j(l),_((A=e((z=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))||this).resourcesForPreload=["rewards_icons/coins/spriteFrame","rewards_icons/exp/spriteFrame","rewards_icons/ton/spriteFrame","rewards/common_background/spriteFrame","rewards/rare_background/spriteFrame","rewards/epic_background/spriteFrame","rewards/legendary_background/spriteFrame","characters/Tonny_avatar/spriteFrame","characters/Gram_avatar/spriteFrame","characters/Chain_avatar/spriteFrame","characters/Crypto_avatar/spriteFrame","characters/Scale_avatar/spriteFrame","characters/Trafik_avatar/spriteFrame"],a(e,"warningText",A,i(e)),a(e,"rewardContainer",L,i(e)),a(e,"rewardItemPrefab",U,i(e)),a(e,"claimButton",W,i(e)),a(e,"claimX2Button",N,i(e)),a(e,"claimX4Button",H,i(e)),a(e,"windowTitle",G,i(e)),a(e,"buttonsContainer",K,i(e)),a(e,"animationDelay",V,i(e)),a(e,"animationDuration",q,i(e)),e.rewards={},e.rewardId=null,e.claimCallback=null,e.isProcessing=!1,e.rewardItems=[],e}n(e,t);var s=e.prototype;return s.init=function(e){var n=this;t.prototype.init.call(this,e),null!=e&&e.rewards?null!=e&&e.rewardId?(this.hideUIElements(),this.rewardId=e.rewardId,this.claimCallback=e.claimCallback||null,this.prepareRewards(e.rewards),this.setupButtonListeners(),this.scheduleOnce((function(){n.animateWindowOpen()}),.2)):console.error("No rewardId provided to RewardWindow"):console.error("No rewards provided to RewardWindow")},s.hideUIElements=function(){this.windowTitle&&((this.windowTitle.getComponent(p)||this.windowTitle.addComponent(p)).opacity=0);this.buttonsContainer&&((this.buttonsContainer.getComponent(p)||this.buttonsContainer.addComponent(p)).opacity=0);this.warningText&&(this.warningText.active=!1)},s.setupButtonListeners=function(){this.claimButton.node.on(l.EventType.TOUCH_END,this.onClaimButtonClicked,this),this.claimX2Button.node.on(l.EventType.TOUCH_END,this.onClaimX2ButtonClicked,this),this.claimX4Button.node.on(l.EventType.TOUCH_END,this.onClaimX4ButtonClicked,this)},s.prepareRewards=function(t){var e=this;this.rewardContainer.removeAllChildren(),this.rewardItems=[],this.rewards={},t.forEach((function(t){var n,a=m(e.rewardItemPrefab);"character_shard"===t.type&&(t.type="character_shard_"+t.metadata.rarity+"-"+t.metadata.characterId),null==(n=a.getComponent(g))||n.applyReward(t.type,t.amount),(a.getComponent(p)||a.addComponent(p)).opacity=0,e.rewardContainer.addChild(a),e.rewardItems.push(a),e.rewards[t.type]?e.rewards[t.type]+=t.amount:e.rewards[t.type]=t.amount,"ton"===t.type&&(e.warningText.active=!0)}));var n=this.rewardContainer.getComponent(h);n&&n.updateLayout();var a=this.rewardContainer.getComponent(T);a&&a.updateLayout()},s.animateWindowOpen=function(){var t=this;if(this.windowTitle){var e=this.windowTitle.getComponent(p);w(e).to(this.animationDuration,{opacity:255}).start()}this.rewardItems.forEach((function(e,n){var a=e.scale.clone();e.setScale(new f(0,0,0)),(e.getComponent(p)||e.addComponent(p)).opacity=255,w(e).delay(n*t.animationDelay).call((function(){k.getInstance().shortVibration()})).to(t.animationDuration,{scale:a},{easing:"backOut"}).start()}));var n=this.rewardItems.length*this.animationDelay+this.animationDuration;this.scheduleOnce((function(){if(t.buttonsContainer){var e=t.buttonsContainer.getComponent(p);w(e).to(t.animationDuration,{opacity:255}).start()}}),n)},s.onClaimX2ButtonClickedAd=function(){var t=this;this.isProcessing||(this.isProcessing=!0,this.disableButtons(),B.getInstance().show(),C.getInstance().post("/api/ads/watch",{productId:"ad_double",metadata:{rewardId:this.rewardId}}),v.getInstance().showAd("DoubleReward",(function(){t.animateClaim(2),t.isProcessing=!1,B.getInstance().hide()}),(function(){t.isProcessing=!1,t.enableButtons(),B.getInstance().hide()})))},s.onClaimX2ButtonClicked=function(){var t=r(o().mark((function t(){var e,n=this;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isProcessing){t.next=2;break}return t.abrupt("return");case 2:return this.isProcessing=!0,this.disableButtons(),t.prev=4,B.getInstance().show(),t.next=8,C.getInstance().post("/api/payments/create-invoice",{productId:"multiply_reward_2",metadata:{rewardId:this.rewardId}});case 8:e=t.sent,I.getInstance().openInvoice(e.invoiceUrl,(function(t){"paid"===t?n.animateClaim(2):(C.getInstance().post("/api/payments/cancel",{orderId:e.orderId}),n.isProcessing=!1,n.enableButtons()),B.getInstance().hide()})),t.next=17;break;case 12:t.prev=12,t.t0=t.catch(4),console.error("Failed to create invoice:",t.t0),this.isProcessing=!1,this.enableButtons();case 17:case"end":return t.stop()}}),t,this,[[4,12]])})));return function(){return t.apply(this,arguments)}}(),s.onClaimX4ButtonClicked=function(){var t=r(o().mark((function t(){var e,n=this;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isProcessing){t.next=2;break}return t.abrupt("return");case 2:return this.isProcessing=!0,this.disableButtons(),t.prev=4,B.getInstance().show(),t.next=8,C.getInstance().post("/api/payments/create-invoice",{productId:"multiply_reward_4",metadata:{rewardId:this.rewardId}});case 8:e=t.sent,I.getInstance().openInvoice(e.invoiceUrl,(function(t){"paid"===t?n.animateClaim(4):(C.getInstance().post("/api/payments/cancel",{orderId:e.orderId}),n.isProcessing=!1,n.enableButtons()),B.getInstance().hide()})),t.next=17;break;case 12:t.prev=12,t.t0=t.catch(4),console.error("Failed to create invoice:",t.t0),this.isProcessing=!1,this.enableButtons();case 17:case"end":return t.stop()}}),t,this,[[4,12]])})));return function(){return t.apply(this,arguments)}}(),s.onClaimButtonClicked=function(){this.isProcessing||(this.isProcessing=!0,this.disableButtons(),this.animateClaim())},s.disableButtons=function(){this.claimButton.interactable=!1,this.claimX2Button.interactable=!1,this.claimX4Button.interactable=!1},s.enableButtons=function(){this.claimButton.interactable=!0,this.claimX2Button.interactable=!0,this.claimX4Button.interactable=!0},s.animateClaim=function(){var t=r(o().mark((function t(e){var n,a=this;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===e&&(e=1),this.claim(e),n=Object.keys(this.rewards).map((function(t){return a.animateRewardItem(t,e)})),t.next=5,Promise.all(n);case 5:this.claimCallback&&this.claimCallback(),this.close();case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),s.animateRewardItem=function(t,e){var n=this;return new Promise((function(a){var i=n.rewardContainer.children.find((function(e){var n=e.getComponent(g);return(null==n?void 0:n.getType())===t}));if(i){var r=i.getComponent(g),o=i.scale.clone(),s=1!==e?1:0;w(i).delay(s).to(.3,{scale:o.clone().multiplyScalar(1.1)},{easing:"quadOut"}).call((function(){r&&"ton"!==t&&r.setAmount(r.getAmount()*e)})).to(.2,{scale:o},{easing:"quadIn"}).delay(.5).call(a).start()}else a()}))},s.claim=function(t){void 0===t&&(t=1),C.getInstance().post("/api/reward/claim/"+this.rewardId,{});var e=y.getInstance();e.addCoins(t*this.rewards.coins||0),e.addTon(this.rewards.ton||0)},s.close=function(){t.prototype.close.call(this),this.claimButton.node.off(l.EventType.TOUCH_END,this.onClaimButtonClicked,this),this.claimX2Button.node.off(l.EventType.TOUCH_END,this.onClaimX2ButtonClicked,this),this.claimX4Button.node.off(l.EventType.TOUCH_END,this.onClaimX4ButtonClicked,this),this.claimCallback=null},e}(b)).prototype,"warningText",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=e(z.prototype,"rewardContainer",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=e(z.prototype,"rewardItemPrefab",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=e(z.prototype,"claimButton",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=e(z.prototype,"claimX2Button",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=e(z.prototype,"claimX4Button",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=e(z.prototype,"windowTitle",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=e(z.prototype,"buttonsContainer",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=e(z.prototype,"animationDelay",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),q=e(z.prototype,"animationDuration",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),S=z))||S));s._RF.pop()}}}));

System.register("chunks:///_virtual/windows",["./BaseWindow.ts","./LootboxWindow.ts","./RewardConfigManager.ts","./RewardItem.ts","./RewardWindow.ts","./WindowType.ts","./WindowsManager.ts"],(function(){return{setters:[null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/WindowsManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BaseWindow.ts","./LoadingService.ts"],(function(i){var n,e,t,o,s,r,a,d,w,c,u,l,h;return{setters:[function(i){n=i.asyncToGenerator,e=i.regeneratorRuntime},function(i){t=i.cclegacy,o=i._decorator,s=i.Node,r=i.Widget,a=i.Prefab,d=i.director,w=i.instantiate,c=i.Director,u=i.assetManager},function(i){l=i.BaseWindow},function(i){h=i.LoadingService}],execute:function(){var f,W;t._RF.push({},"19bffL9sk1LBJfgMu+lMDOX","WindowsManager",void 0);var g=o.ccclass;i("WindowsManager",g("WindowsManager")(((W=function(){function i(){this.activeWindow=null,this.windowsStack=[],this.windows=new Map,this.loadedWindows=new Map,this.windowsLayer=null,this.isClosingWindow=!1,this.isOpeningWindow=!1,d.on(c.EVENT_BEFORE_SCENE_LOADING,this.clearLoadedWindows,this)}var t=i.prototype;return t.registerWindow=function(i){this.windows.set(i,""+i)},t.showWindow=function(){var i=n(e().mark((function i(n,t){var o,s,r,a,d=this;return e().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!this.isOpeningWindow){i.next=2;break}return i.abrupt("return");case 2:if(this.isOpeningWindow=!0,i.prev=3,this.activeWindow&&this.activeWindow.active&&this.windowsStack.push(this.activeWindow),o=this.loadedWindows.get(n)){i.next=23;break}if(h.getInstance().show(),s=this.windows.get(n)){i.next=13;break}return console.error('Window "'+n+'" is not registered.'),this.isOpeningWindow=!1,i.abrupt("return");case 13:return i.next=15,this.loadPrefab(s);case 15:if(r=i.sent){i.next=20;break}return console.error('Failed to load prefab for window "'+n+'"'),this.isOpeningWindow=!1,i.abrupt("return");case 20:o=w(r),this.loadedWindows.set(n,o),h.getInstance().hide();case 23:if(a=o.getComponent(l)){i.next=28;break}return console.warn('Window "'+n+'" does not extend BaseWindow.'),this.isOpeningWindow=!1,i.abrupt("return");case 28:this.setupWindowLayers(o),o.active=!0,this.activeWindow=o,o.setSiblingIndex(999),a.open(t),setTimeout((function(){d.isOpeningWindow=!1}),300),i.next=40;break;case 36:i.prev=36,i.t0=i.catch(3),console.error("Error opening window "+n+":",i.t0),this.isOpeningWindow=!1;case 40:case"end":return i.stop()}}),i,this,[[3,36]])})));return function(n,e){return i.apply(this,arguments)}}(),t.setupWindowLayers=function(i){this.getWindowsLayer().addChild(i)},t.getWindowsLayer=function(){if(!this.windowsLayer){var n=this.getCanvas();if(!n)throw new Error("Canvas not found");if(this.windowsLayer=n.getChildByName(i.WINDOWS_LAYER_NAME),!this.windowsLayer){this.windowsLayer=new s(i.WINDOWS_LAYER_NAME);var e=this.windowsLayer.addComponent(r);e.isAlignTop=!0,e.isAlignBottom=!0,e.isAlignLeft=!0,e.isAlignRight=!0,e.top=0,e.bottom=0,e.left=0,e.right=0,e.alignMode=r.AlignMode.ALWAYS,n.addChild(this.windowsLayer),this.windowsLayer.setSiblingIndex(9e3)}}return this.windowsLayer},t.hideActiveWindow=function(){var i=this;if(!this.isClosingWindow&&this.activeWindow&&this.activeWindow.active){this.isClosingWindow=!0;var n=this.activeWindow,e=n.getComponent(l);e?e.close():n.active=!1,0===this.windowsStack.length?this.activeWindow=null:this.activeWindow=this.windowsStack.pop(),setTimeout((function(){i.isClosingWindow=!1}),300)}},t.loadPrefab=function(){var i=n(e().mark((function i(n){var t=this;return e().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",new Promise((function(i){var e=u.getBundle("windows");e?t.loadPrefabFromBundle(e,n,i):u.loadBundle("windows",(function(e,o){if(e)return console.error("Failed to load windows bundle: "+e),void i(null);t.loadPrefabFromBundle(o,n,i)}))})));case 1:case"end":return i.stop()}}),i)})));return function(n){return i.apply(this,arguments)}}(),t.loadPrefabFromBundle=function(i,n,e){i.load(n,a,(function(i,t){if(i)return console.error("Failed to load prefab "+n+": "+i),void e(null);e(t)}))},t.getCanvas=function(){return d.getScene().getChildByName("Canvas")||null},t.clearLoadedWindows=function(){this.loadedWindows.forEach((function(i){i.isValid&&i.destroy()})),this.loadedWindows.clear(),this.activeWindow=null,this.windowsLayer=null,this.windowsStack=[]},t.preloadWindow=function(i,n){var e=this;if(this.loadedWindows.has(i))n&&n();else{var t=this.windows.get(i);if(!t)return console.error('Window "'+i+'" is not registered.'),void(n&&n());this.loadPrefab(t).then((function(t){if(t){var o=w(t);e.loadedWindows.set(i,o),console.log("Window prefab preloaded: "+i)}n&&n()}))}},i}()).WINDOWS_LAYER_NAME="WindowsLayer",f=W))||f);t._RF.pop()}}}));

System.register("chunks:///_virtual/WindowType.ts",["cc"],(function(e){var n;return{setters:[function(e){n=e.cclegacy}],execute:function(){n._RF.push({},"fae2cObzRhJlpIBd4EhvEHk","WindowType",void 0);e("WindowType",function(e){return e[e.FULLSCREEN=0]="FULLSCREEN",e[e.MODAL=1]="MODAL",e[e.POPUP=2]="POPUP",e}({}));n._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/windows', 'chunks:///_virtual/windows'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});